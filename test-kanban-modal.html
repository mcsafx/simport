<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Modal Kanban - SISGIMP</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .test-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #1d4ed8;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            background: #f8fafc;
            border-left: 4px solid #10b981;
        }
        .error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Integra√ß√£o: Modal Kanban com Invoices</h1>
        <p>Sistema de testes para validar a funcionalidade do modal de invoices no Kanban do SISGIMP.</p>

        <!-- Teste 1: Conex√£o com Backend -->
        <div class="test-section">
            <h2>1. üîå Teste de Conex√£o com Backend</h2>
            <p>Verifica se o backend est√° respondendo corretamente.</p>
            <button class="test-button" onclick="testBackendConnection()">Testar Conex√£o</button>
            <div id="backend-result"></div>
        </div>

        <!-- Teste 2: Buscar Embarques -->
        <div class="test-section">
            <h2>2. üì¶ Teste: Buscar Embarques</h2>
            <p>Carrega a lista de embarques dispon√≠veis.</p>
            <button class="test-button" onclick="testEmbarques()">Buscar Embarques</button>
            <div id="embarques-result"></div>
        </div>

        <!-- Teste 3: Buscar Invoices -->
        <div class="test-section">
            <h2>3. üìÑ Teste: Buscar Invoices de um Embarque</h2>
            <p>Carrega as invoices de um embarque espec√≠fico.</p>
            <button class="test-button" onclick="testInvoices()">Buscar Invoices</button>
            <div id="invoices-result"></div>
        </div>

        <!-- Teste 4: Cadastros -->
        <div class="test-section">
            <h2>4. üìã Teste: Dados de Cadastros</h2>
            <p>Verifica se os dados de cadastros est√£o dispon√≠veis.</p>
            <button class="test-button" onclick="testExportadores()">Exportadores</button>
            <button class="test-button" onclick="testUnidadesMedida()">Unidades de Medida</button>
            <div id="cadastros-result"></div>
        </div>

        <!-- Teste 5: Simular Modal -->
        <div class="test-section">
            <h2>5. üé≠ Simular Modal de Invoices</h2>
            <p>Simula o comportamento do modal do Kanban.</p>
            <button class="test-button" onclick="simulateModal()">Abrir Modal Simulado</button>
            <div id="modal-result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        
        // Fun√ß√£o auxiliar para exibir resultados
        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${isError ? 'error' : 'success'}">${content}</div>`;
        }

        // Teste 1: Conex√£o Backend
        async function testBackendConnection() {
            try {
                const response = await fetch('http://localhost:3001/health');
                const data = await response.json();
                
                showResult('backend-result', `
                    ‚úÖ <strong>Backend Online!</strong><br>
                    Status: ${data.status}<br>
                    Servi√ßo: ${data.service}<br>
                    Timestamp: ${data.timestamp}
                `);
            } catch (error) {
                showResult('backend-result', `
                    ‚ùå <strong>Erro na conex√£o:</strong><br>
                    ${error.message}
                `, true);
            }
        }

        // Teste 2: Embarques
        async function testEmbarques() {
            try {
                const response = await fetch(`${API_BASE}/embarques`);
                const data = await response.json();
                
                if (data.success && data.data.data.length > 0) {
                    const embarques = data.data.data;
                    showResult('embarques-result', `
                        ‚úÖ <strong>${embarques.length} embarques encontrados</strong><br>
                        <pre>${JSON.stringify(embarques[0], null, 2)}</pre>
                    `);
                } else {
                    showResult('embarques-result', '‚ö†Ô∏è Nenhum embarque encontrado', true);
                }
            } catch (error) {
                showResult('embarques-result', `‚ùå Erro: ${error.message}`, true);
            }
        }

        // Teste 3: Invoices
        async function testInvoices() {
            try {
                // Usar o embarque de teste conhecido
                const embarqueId = 'cmdqk96x8000auua14m5210zn';
                const response = await fetch(`${API_BASE}/invoices/embarque/${embarqueId}`);
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const invoices = data.data;
                    showResult('invoices-result', `
                        ‚úÖ <strong>${invoices.length} invoice(s) encontrada(s)</strong><br>
                        Invoice: ${invoices[0].numero}<br>
                        Valor: ${new Intl.NumberFormat('pt-BR', {
                            style: 'currency',
                            currency: invoices[0].moeda
                        }).format(invoices[0].valorTotal)}<br>
                        Produtos: ${invoices[0].produtos?.length || 0}<br>
                        Containers: ${invoices[0].containers?.length || 0}<br>
                        <pre>${JSON.stringify(invoices[0], null, 2)}</pre>
                    `);
                } else {
                    showResult('invoices-result', '‚ö†Ô∏è Nenhuma invoice encontrada para este embarque', true);
                }
            } catch (error) {
                showResult('invoices-result', `‚ùå Erro: ${error.message}`, true);
            }
        }

        // Teste 4: Exportadores
        async function testExportadores() {
            try {
                const response = await fetch(`${API_BASE}/cadastros/exportadores`);
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    showResult('cadastros-result', `
                        ‚úÖ <strong>${data.data.length} exportadores encontrados</strong><br>
                        ${data.data.map(exp => `‚Ä¢ ${exp.nomeEmpresa} (${exp.pais}) - ERP: ${exp.codigoERP}`).join('<br>')}
                    `);
                } else {
                    showResult('cadastros-result', '‚ö†Ô∏è Nenhum exportador encontrado', true);
                }
            } catch (error) {
                showResult('cadastros-result', `‚ùå Erro: ${error.message}`, true);
            }
        }

        // Teste 4: Unidades de Medida
        async function testUnidadesMedida() {
            try {
                const response = await fetch(`${API_BASE}/cadastros/unidades-medida`);
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    showResult('cadastros-result', `
                        ‚úÖ <strong>${data.data.length} unidades de medida encontradas</strong><br>
                        ${data.data.map(um => `‚Ä¢ ${um.codigo} - ${um.nome} (${um.simbolo})`).join('<br>')}
                    `);
                } else {
                    showResult('cadastros-result', '‚ö†Ô∏è Nenhuma unidade de medida encontrada', true);
                }
            } catch (error) {
                showResult('cadastros-result', `‚ùå Erro: ${error.message}`, true);
            }
        }

        // Teste 5: Simular Modal
        async function simulateModal() {
            try {
                const embarqueId = 'cmdqk96x8000auua14m5210zn';
                
                // Buscar embarque
                const embarqueResponse = await fetch(`${API_BASE}/embarques`);
                const embarqueData = await embarqueResponse.json();
                const embarque = embarqueData.data.data.find(e => e.id === embarqueId);
                
                // Buscar invoices
                const invoiceResponse = await fetch(`${API_BASE}/invoices/embarque/${embarqueId}`);
                const invoiceData = await invoiceResponse.json();
                
                if (embarque && invoiceData.success) {
                    const invoices = invoiceData.data;
                    
                    showResult('modal-result', `
                        ‚úÖ <strong>Modal Simulado com Sucesso!</strong><br>
                        <br>
                        <strong>üì¶ Embarque:</strong> ${embarque.numeroReferencia}<br>
                        <strong>üè≠ Exportador:</strong> ${embarque.exportador.nomeEmpresa}<br>
                        <strong>üö¢ Armador:</strong> ${embarque.armador.nome}<br>
                        <strong>üìç Rota:</strong> ${embarque.portoOrigem.nome} ‚Üí ${embarque.portoDestino.nome}<br>
                        <br>
                        <strong>üìÑ Invoices (${invoices.length}):</strong><br>
                        ${invoices.map(inv => `
                            ‚Ä¢ ${inv.numero} - ${new Intl.NumberFormat('pt-BR', {
                                style: 'currency',
                                currency: inv.moeda
                            }).format(inv.valorTotal)}<br>
                            &nbsp;&nbsp;${inv.produtos?.length || 0} produtos, ${inv.containers?.length || 0} containers
                        `).join('<br>')}
                        <br>
                        <strong>üéØ Status da Integra√ß√£o:</strong> <span style="color: #10b981;">‚úÖ FUNCIONANDO!</span>
                    `);
                } else {
                    showResult('modal-result', '‚ùå Erro ao simular modal', true);
                }
            } catch (error) {
                showResult('modal-result', `‚ùå Erro: ${error.message}`, true);
            }
        }
    </script>
</body>
</html>